{% extends 'base.html' %}

{% block title %}GardenCircle ‚Äî Pr√≠spevky{% endblock %}

{% block content %}
  <section class="card">
    <header class="section-header">
      <h2>Pr√≠spevky komunity</h2>
      <p class="muted">Pridaj sk√∫senos≈• alebo ot√°zku ‚Äì komunita ti porad√≠</p>
    </header>

    <!-- Post Form -->
    <form id="postForm" class="post-form" method="post" action="/api/posts" enctype="multipart/form-data" aria-label="Prida≈• pr√≠spevok">
      <label for="postInput" class="visually-hidden">Tvoje zdieƒæanie</label>
      <textarea name="content" id="postInput" rows="4" placeholder="Nap√≠≈° svoj probl√©m alebo sk√∫senos≈•..." required></textarea>
      
      <div class="form-group" style="margin-top: var(--space-md);">
        <label for="fileInput" style="cursor: pointer; display: inline-flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm) var(--space-md); background: var(--light-green); border-radius: var(--radius-lg); border: 2px dashed var(--mint); color: var(--primary-green); font-weight: 600;">
          üì∑ Vybra≈• obr√°zok
        </label>
        <input type="file" id="fileInput" name="file" accept="image/*" style="display: none;" onchange="previewImage(this)">
        <div id="imagePreview" style="margin-top: var(--space-md); display: none;">
          <img id="previewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: var(--radius-lg); border: 2px solid var(--mint);">
          <button type="button" onclick="removeImage()" style="margin-left: var(--space-sm); padding: var(--space-xs) var(--space-sm); background: #fee; color: #c33; border: none; border-radius: var(--radius-sm); cursor: pointer;">‚úï</button>
        </div>
      </div>
      
      <div class="form-row" style="margin-top: var(--space-md);">
        <button type="submit" class="btn btn-primary">Prida≈• pr√≠spevok</button>
      </div>
    </form>
  </section>

  <!-- Posts Feed -->
  <section class="card">
    <ul id="postList" class="post-list" aria-live="polite">
      {% if posts %}
        {% for p in posts %}
          <li class="post-card" data-id="{{ p.id }}">
            <div class="post-header">
              <div class="meta">
                <a href="{{ url_for('user_profile', username=p.author) }}" style="text-decoration: none; color: var(--primary-green);">
                  <strong class="author">{{ p.author }}</strong>
                </a>
                <time class="time">{{ p.created_at }}</time>
              </div>
            </div>
            <p class="post-content">{{ p.content }}</p>
            {% if p.image_path %}
              <img src="{{ url_for('static', filename=p.image_path) }}" alt="Obr√°zok pr√≠spevku">
            {% endif %}
          </li>
        {% endfor %}
      {% else %}
        <li class="muted text-center" style="padding: var(--space-2xl);">
          Zatiaƒæ ≈æiadne pr√≠spevky ‚Äî buƒè prv√Ω a zdieƒæaj svoju sk√∫senos≈•!
        </li>
      {% endif %}
    </ul>
  </section>
  
  <!-- Post Template for JavaScript -->
  <template id="post-template">
    <li class="post-card">
      <div class="post-header">
        <div class="meta">
          <strong class="author"></strong>
          <time class="time" datetime=""></time>
        </div>
        <div class="post-actions">
          <button class="btn btn-ghost btn-small delete-post" title="Vymaza≈• pr√≠spevok">üóëÔ∏è</button>
        </div>
      </div>
      <p class="post-content"></p>
      <div class="comments">
        <ul class="comment-list"></ul>
        <form class="comment-form" aria-label="Prida≈• koment√°r">
          <input class="comment-input" type="text" placeholder="Nap√≠≈° koment√°r..." required>
          <button class="btn btn-primary btn-small">Odosla≈•</button>
        </form>
      </div>
    </li>
  </template>

  <script>
    function previewImage(input) {
      const preview = document.getElementById('imagePreview');
      const previewImg = document.getElementById('previewImg');
      
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImg.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
    
    function removeImage() {
      document.getElementById('fileInput').value = '';
      document.getElementById('imagePreview').style.display = 'none';
    }
  </script>
{% endblock %}